<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regresión Lineal Simple Bayesiana</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Bayesian_Linear_Regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-html/quarto.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-html/popper.min.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="Bayesian_Linear_Regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Bayesian_Linear_Regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Bayesian_Linear_Regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Bayesian_Linear_Regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Bayesian_Linear_Regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/stickythead.js"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/datatables.min.js" kdttablesentinel="true"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/pdfmake.min.js" kdttablesentinel="true"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/vfs_fonts.js" kdttablesentinel="true"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="Bayesian_Linear_Regression_files/libs/quarto-dashboard/components.js"></script>
<link href="Bayesian_Linear_Regression_files/libs/quarto-dashboard/datatables.min.css" rel="stylesheet" kdttablesentinel="true">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="quarto-dashboard dashboard-sidebar fullcontent">

<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


    <div class="navbar-brand-container">       

      <div class="navbar-title">
        <div class="navbar-title-text"><a href="#">Regresión Lineal Simple Bayesiana</a></div>
        
        
      </div>
    </div>
<div id="dashboard-collapse" class="navbar-collapse collapse"><ul class="navbar-nav navbar-nav-scroll me-auto" role="tablist"><li class="nav-item" role="presentation"><a id="tab-regresión-lineal-simple" class="nav-link active" data-bs-toggle="tab" role="tab" data-bs-target="#regresión-lineal-simple" data-scrolling="true" href="#regresión-lineal-simple" aria-controls="regresión-lineal-simple" aria-selected="true"><span class="nav-link-text">Regresión Lineal Simple</span></a></li><li class="nav-item" role="presentation"><a id="tab-app" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#app" data-scrolling="true" href="#app" aria-controls="app" aria-selected="false"><span class="nav-link-text">App</span></a></li><li class="nav-item" role="presentation"><a id="tab-demostraciones" class="nav-link" data-bs-toggle="tab" role="tab" data-bs-target="#demostraciones" data-scrolling="true" href="#demostraciones" aria-controls="demostraciones" aria-selected="false"><span class="nav-link-text">Demostraciones</span></a></li></ul></div></div>
</nav>
</header>
<div class="page-layout-custom quarto-dashboard-content bslib-gap-spacing html-fill-container dashboard-scrolling quarto-dashboard-pages">  

<div class="bslib-grid-item html-fill-item tab-content bslib-grid" data-layout="flow" style="display: grid; grid-template-rows: minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div id="regresión-lineal-simple" class="dashboard-page tab-pane show active html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-regresión-lineal-simple">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, 30fr) minmax(3em, 70fr); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-title="Motivación: Ley de Igualación Generalizada" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title">Motivación: Ley de Igualación Generalizada</div></div>
<div class="card-body html-fill-item html-fill-container">
<p>La ley de igualación generaliza de Baum (1974) nos indica que las tasas de respuesta o de tiempo dedicado a cada opción (programa de refuerzo) se relaciona con la tasa de reforzamiento de la siguiente forma:</p>
<span class="math display">\[
\frac{B_1}{B_2} = \beta_0 (\frac{R_1}{R_2})^{\beta_1}
\]</span>
Donde:
<ul>
<li><span class="math inline">\(\frac{B_1}{B_2}\)</span> representa la razón de las tasas de respuesta o el tiempo dedicado a cada opción.</li>
<li><span class="math inline">\(\frac{R_1}{R_2}\)</span> representan las tasas de reforzamiento en cada opción.</li>
<li><span class="math inline">\(\beta_0\)</span> es el sego que se tiene por la opción 1 en comparación a la opción 2.</li>
<li><span class="math inline">\(\beta_1\)</span> es la sensibilidad que se tiene a las diferencias en las tasas de reforzamiento.</li>
</ul>
<p>Este modelo ha sido ampliamente utilizado para entender la conducta de elección y distribución del comportamiento tanto en humanos y otras especies. En los experimentos de elección en general tenemos dos opciones con distintos o mismos programas de refuerzo (IV, VI, FR, etc.) concurrentes y se mide la tasa de respuesta o tiempo dedicado a cada opción. Dado que la tasa de refuerzo es controlada, lo que se busca es estimar tanto el sesgo como la sensibilidad dadas otras condiciones experimentales (volatilidad del ambiente, contextos distintos, etc.).</p>
<p>Dada la forma funcional del modelo, estimar los parámetros sería complicado, pero usando las propiedades matemáticas del logarítmo, podemos transformarlo en un modelo lineal simple.</p>
<p><span class="math display">\[
log(\frac{B_1}{B_2}) = log(\beta_0) + \beta_1 log(\frac{R_1}{R_2})
\]</span> La interpretación de esta versión modificada del modelo permanece sin cambios, simplemente se tiene que tomar en cuenta que la escala de las variables cambia.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="card html-fill-item html-fill-container bslib-card" data-title="Estimación de Parámetros." data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title">Estimación de Parámetros.</div></div>
<div class="card-body html-fill-item html-fill-container">
<p>Dado que nuestro modelo es una versión del modelo lineal simple, podemos estimar los parámetros por distintos métodos tales como mínimos cuadrados ordinarios (OLS, por sus siglas en inglés), máxima verosimilitud (MLE) o por métodos bayesianos. Para nuestro ejemplo usaremos el método bayesiano.</p>
<p>En el enfoque bayesiano se busca estimar la distribución de los parámetros dado los datos observados está distribución es conocida como posterior y es el resultado de combinar la información previa que se tiene de los parámetros con la información que se tiene de los datos observados dado nuestro modelo.</p>
<p>Definimos la posterior como:</p>
<span class="math display">\[
p(\Theta|x_1, \dots, x_n) \propto p(x_1, \dots, x_n| \Theta) p(\Theta)
\]</span>
Donde:
<ul>
<li><span class="math inline">\(p(x_1, \dots, x_n| \Theta)\)</span> es la verosimilitud de los datos dado los parámetros del modelo.</li>
<li><span class="math inline">\(p(\Theta)\)</span> es la distribución prior o inicial que representa nuestro conocimiento de los parámetros antes de observar los datos.</li>
</ul>
<p>A pesar de la facilidad a prmera vista, el obtener la distribución posterior no es una tarea trivial y en general no tiene una forma analítica cerrada por lo que a menudo se recurre a métodos numéricos para obtener una aproximación a la distribución posterior, tales como MCMC (Markov Chain Monte Carlo) o métodos variacionales.</p>
<p>Sin embargo, en casos particulares es posible obtener expresiones tratables matemáticamente para la distribución posterior, en particular cuando dado un prior conjugado, la distribución posterior es de la misma familia que el prior, el prior conjugado no existe para todos los modelos, pero en nuestro caso existe.</p>
<p>Antes de ver el prior, es importante conocer nuestra función de verosimilitud, la cual para el modelo lineal simple es:</p>
<span class="math display">\[
p(y|X, \beta, \sigma^2) = \prod_{i=1}^{n} \frac{1}{\sqrt{2\pi \sigma^2}} exp(-\frac{1}{2\sigma^2}(y_i - \beta_0 - \beta_1 x_i)^2)
\]</span>
<p>Usando notación de algebra lineal, se puede reescribir como:</p>
<span class="math display">\[
p(y|X, \beta, \sigma^2) = \frac{1}{(2\pi \sigma^2)^{n/2}} exp(-\frac{1}{2\sigma^2}(y - X\beta)^T(y - X\beta))
\]</span>
<p>Nuestro prior conjugado es una distribución normal multivariada para los parámetros <span class="math inline">\(\beta\)</span> y una distribución gamma inversa para la varianza <span class="math inline">\(\sigma^2\)</span>, la distribución completa es simplemente el producto de ambos, pero cabe destacar que la distribución de los parámetros <span class="math inline">\(\beta\)</span> depende de la vairanza <span class="math inline">\(\sigma^2\)</span>. Podemos expresarlo como:</p>
<span class="math display">\[
p(\beta, \sigma^2) = p(\beta|\sigma^2) p(\sigma^2)
\]</span>
<span class="math display">\[
p(\beta, \sigma^2) = N_n (\beta|\beta_0, \sigma^2 \Sigma) IG(\sigma^2|\nu_0, s_0^2)
\]</span>
<p>Usando su densidad de probabilidad, tenemos:</p>
<span class="math display">\[
p(\beta, \sigma^2) = \frac{1}{(2\pi)^{k/2} |\Sigma|^{1/2}} exp(-\frac{1}{2}(\beta - \beta_0)^T \Sigma^{-1} (\beta - \beta_0)) \times \frac{1}{B(\frac{\nu_0}{2}, \frac{\nu_0 s_0^2}{2})} (\frac{\nu_0 s_0^2}{2})^{\frac{\nu_0}{2}} (\sigma^2)^{-\frac{\nu_0 + k + 2}{2}} exp(-\frac{\nu_0 s_0^2}{2 \sigma^2})
\]</span>
<p>Usando la verosimilitud y el prior conjugado, se puede demostrar que la distrobución posterior es una distribución normal multivariada para los parámetros <span class="math inline">\(\beta\)</span> y una distribución gamma inversa para la varianza <span class="math inline">\(\sigma^2\)</span>. Los parámetros actualizdos para la posterior son: <span class="math display">\[\begin{align*}
\mu_{\beta} &amp;= (X^TX + A)^{-1}(X^Ty + A\beta_0) \\
\sigma^2 &amp;= \frac{S}{n + \nu_0} \\
\nu_n &amp;= n + \nu_0 \\
s_n^2 &amp;= \frac{S}{2} \\
S &amp;= \nu_0 s_0^2 + y^Ty + \beta_0^T A \beta_0 - \mu_{\beta}^T(X^TX + A)\mu_{\beta}
\end{align*}\]</span></p>
<p>Donde <span class="math inline">\(A\)</span> es la matriz de covarianza de los parámetros <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\nu_0\)</span> y <span class="math inline">\(s_0^2\)</span> son los hiperparámetros de la distribución gamma inversa. Nuestra distribución posterior es:</p>
<span class="math display">\[
p(\beta, \sigma^2|y, X) = N_{k}(\beta|\mu_{\beta}, \sigma^2 (X^TX + A)^{-1}) IG(\sigma^2|\nu_n, s_n^2)
\]</span>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
<div id="app" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container dashboard-sidebar-container" data-orientation="rows" aria-labelledby="tab-app">
<div class="bslib-sidebar-layout html-fill-item html-fill-container" data-bslib-sidebar-open="desktop" data-bslib-sidebar-init="true" data-bslib-sidebar-border="false" data-bslib-sidebar-border-radius="false"><div class="main html-fill-container html-fill-item"><div class="sidebar-content html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" data-height="35%" style="display: grid; grid-template-rows: minmax(3em, 1fr) minmax(3em, 1fr) minmax(3em, 1fr); grid-auto-columns: minmax(0, 1fr);">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="Datos" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container">Datos</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="plotdata" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card cell html-fill-item html-fill-container bslib-card" data-title="Estimación" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container">Estimación</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="plotpostfitdata" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="Conjunta Intercepto, Pendiente" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container">Conjunta Intercepto, Pendiente</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="plot_betas_postconj" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div><div class="card cell html-fill-item html-fill-container bslib-card" data-title="Marginal para la Varianza" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container">Marginal para la Varianza</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="plot_sigma_post" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-columns: minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="card cell html-fill-item html-fill-container bslib-card" data-title="Marginales Teóricas vs Muestreadas" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-header"><div class="card-title html-fill-item html-fill-container">Marginales Teóricas vs Muestreadas</div></div>
<div class="card-body html-fill-item html-fill-container">
<div class="cell-output-display html-fill-item html-fill-container">
<div class="shiny-plot-output html-fill-item html-fill-container" id="plot_marginales" style="width:100%;height:400px;"></div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
</div>
</div>
</div></div><aside id="bslib-sidebar-1" class="sidebar html-fill-container html-fill-item"><div class="html-fill-item html-fill-container">
<div class="cell-output-display">
<button id="run_sampling" type="button" class="btn btn-default action-button">Muestrear</button>
</div>
<div class="cell-output-display">
<br>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="n_samples-label" for="n_samples">Tamaño de Muestra Posterior</label>
<input id="n_samples" type="number" class="shiny-input-number form-control" value="1000" min="10" max="10000" step="25">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="alpha-label" for="alpha">Tamaño de HDI</label>
<input id="alpha" type="number" class="shiny-input-number form-control" value="0.9" min="0.7" max="0.99" step="0.01">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="prior_mean_b0-label" for="prior_mean_b0">Media Intercepto</label>
<input id="prior_mean_b0" type="number" class="shiny-input-number form-control" value="0" min="-10" max="10" step="0.1">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="prior_mean_b1-label" for="prior_mean_b1">Media Pendiente</label>
<input id="prior_mean_b1" type="number" class="shiny-input-number form-control" value="0" min="-10" max="10" step="0.1">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="sd_mean_b0-label" for="sd_mean_b0">Desviación Est. Intercepto</label>
<input id="sd_mean_b0" type="number" class="shiny-input-number form-control" value="1" min="0.01" max="20" step="0.1">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="sd_mean_b1-label" for="sd_mean_b1">Desviación Est. Pendiente</label>
<input id="sd_mean_b1" type="number" class="shiny-input-number form-control" value="1" min="0.01" max="20" step="0.1">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="prior_corr-label" for="prior_corr">Correlación entre Intercepto y Pendiente</label>
<input id="prior_corr" type="number" class="shiny-input-number form-control" value="0" min="-1" max="1" step="0.05">
</div>
</div>
<div class="cell-output-display">
<br>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container no-baseline">
<label class="control-label" id="df_chi-label" for="df_chi">Grados de Libertad</label>
<input class="js-range-slider" id="df_chi" data-skin="shiny" data-min="1" data-max="30" data-from="1" data-step="1" data-grid="true" data-grid-num="9.66666666666667" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div class="form-group shiny-input-container no-baseline">
<label class="control-label" id="scale_chi-label" for="scale_chi">Escala</label>
<input class="js-range-slider" id="scale_chi" data-skin="shiny" data-min="1" data-max="20" data-from="1" data-step="0.1" data-grid="true" data-grid-num="10" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
</div></aside>
<button class="collapse-toggle" type="button" title="Toggle sidebar" aria-expanded="true" aria-controls="bslib-sidebar-1">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" class="bi bi-chevron-left collapse-icon" style="fill:currentColor;" aria-hidden="true" role="img">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
    </svg>
</button>
<script data-bslib-sidebar-init="">
bslib.Sidebar.initCollapsibleAll()
</script>
</div>
</div>
<div id="demostraciones" class="dashboard-page tab-pane grid-skip html-fill-item html-fill-container" data-orientation="rows" aria-labelledby="tab-demostraciones">
<div class="html-fill-item html-fill-container bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card html-fill-item html-fill-container bslib-card" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container flow">
ahjsbfhjkbas
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
library(data.table)
library(ggplot2)
library(GGally)
library(viridis)
library(gridExtra)
library(invgamma)
library(HDInterval)
library(MASS)

plot_bayes_regression <- function(y, X, posterior_samples, 
                                  beta_bar, A, nu0, s0_sq,  # Se agregan hiperparámetros
                                  alpha = 0.95, 
                                  use_theoretical = FALSE) 
                                  {
    
    library(ggplot2)
    library(HDInterval)
    
    # Validar que solo hay un predictor más intercepto
    if(ncol(posterior_samples$beta) != 2) {
        stop("La función solo funciona para modelos con intercepto y un predictor")
    }

    X <- cbind(1, X)
    n <- nrow(X)
    k <- 2
    # Crear data frame para ggplot
    data_df <- data.frame(y = y, x = X[,2])  # Asume que X ya incluye intercepto
    
    # Secuencia de x para predicción
    x_seq <- seq(min(data_df$x), max(data_df$x), length.out = n)
    
    # Matriz de diseño para predicción
    X_pred <- cbind(1, x_seq)
    
    # Calcular estimación teórica exacta (usando prior conjugado)
    if(use_theoretical) {
        
        XtX <- crossprod(X)
        XtX_A <- XtX + A
        XtX_A_inv <- solve(XtX_A)
        
        beta_hat <- XtX_A_inv %*% (XtX %*% beta_bar + crossprod(X, y))
        
        S <- nu0 * s0_sq + crossprod(y) - t(beta_bar) %*% XtX %*% beta_bar
        sigma2_hat <- S / (nrow(X) + nu0)  # Media de la distribución inversa-gamma
        
        theoretical_fit <- X_pred %*% beta_hat
    }
    
    # Media posterior de beta
    beta_post_mean <- colMeans(posterior_samples$beta)
    
    # Generar distribuciones predictivas
    post_pred <- X_pred %*% t(posterior_samples$beta)
    
    # Calcular HDI
    hdi_bounds <- apply(post_pred, 1, function(x) hdi(x, credMass = alpha))
    
    # Crear data frame para gráfico
    plot_df <- data.frame(
        x = x_seq,
        post_mean = rowMeans(post_pred),
        hdi_lower = hdi_bounds[1,],
        hdi_upper = hdi_bounds[2,]
    )
    
    if(use_theoretical) plot_df$theoretical <- theoretical_fit
    
    # Crear gráfico base
    gg <- ggplot(data_df, aes(x = x, y = y)) +
        geom_point(alpha = 0.5, color = "#4B0082") +
        geom_line(data = plot_df, aes(y = post_mean, color = "Muestreo"),
                  linewidth = 1.2) +
        geom_ribbon(data = plot_df, aes(ymin = hdi_lower, ymax = hdi_upper),
                    fill = "#2F4F4F", alpha = 0.2) +
        labs(
            title = "",
            y = expression(log(frac(plain(B)[1], plain(B)[2]))),
            x = expression(log(frac(plain(R)[1], plain(R)[2]))),
            color = "Estimación") +  # Añadir título de la leyenda
        theme_minimal(base_size = 14) +
        theme(legend.position = "top")
    
    # Añadir línea teórica si se solicita
    if(use_theoretical) {
        gg <- gg + geom_line(data = plot_df, aes(y = theoretical, color = "Teórica"),
                             linewidth = 1.2, linetype = "dashed")
    }
    
    return(gg)
}


sampling_posterior <- function(y, X, 
                                beta_bar = NULL, 
                                A = NULL, 
                                nu0 = 1, 
                                s0_sq = 1, 
                                n_samples = 10000) {
    X <- cbind(1, X)
    n <- nrow(X)
    k <- ncol(X)
    XtX <- crossprod(X)
    XtX_A <- XtX + A
    XtX_A_inv <- solve(XtX_A)
    beta_post_mean <- XtX_A_inv %*% (crossprod(X, y) + A %*% beta_bar)
    
    # Calcular término escalar S
    S <- nu0 * s0_sq + 
        crossprod(y) + 
        t(beta_bar) %*% A %*% beta_bar - 
        t(beta_post_mean) %*% XtX_A %*% beta_post_mean
    
    # Parámetros para la inversa-gamma
    shape <- (n + nu0) / 2
    scale <- S / 2
    
    # Almacenamiento de muestras
    samples <- list(
        beta = matrix(NA, nrow = n_samples, ncol = k),
        sigma2 = numeric(n_samples)
    )
    colnames(samples$beta) <- colnames(X)
    
    # Muestreo Gibbs
    for (i in 1:n_samples) {
        # Muestrear sigma²
        samples$sigma2[i] <- 1 / rgamma(1, shape = shape, rate = scale)
        
        # Muestrear beta
        samples$beta[i, ] <- MASS::mvrnorm(
            n = 1,
            mu = XtX_A_inv %*% (crossprod(X, y) + A %*% beta_bar),
            Sigma = samples$sigma2[i] * XtX_A_inv
        )
    }
    
    return(samples)
}

# Si no tienes instaladas las librerías:
# install.packages(c("ggplot2", "GGally", "viridis"))

plot_joint_posterior <- function(posterior_samples, alpha = 0.7, bins = 30) {
    beta_df <- as.data.frame(posterior_samples$beta)
    colnames(beta_df) <- c("Intercepto", "Pendiente")
    
    # Función personalizada para gráficos inferiores (2D density)
    lower_fn <- function(data, mapping, ...) {
        ggplot(data = data, mapping = mapping) +
            geom_density_2d_filled(aes(fill = after_stat(level)), alpha = alpha, bins = bins) +
            scale_fill_viridis_d(option = "magma") +
            theme_minimal()
    }
    
    # Función personalizada para la diagonal (densidad)
    diag_fn <- function(data, mapping, ...) {
        ggplot(data = data, mapping = mapping) +
            geom_density(fill = "#4B0082", alpha = 0.6, color = "black") +
            theme_minimal()
    }
    
    # Función personalizada para gráficos superiores (correlación)
    upper_fn <- function(data, mapping, ...) {
        ggally_cor(data = data, mapping = mapping, 
                   size = 5, color = "darkred", 
                   display_grid = FALSE) +
            theme_void()
    }
    
    # Crear la matriz de gráficos
    gg <- ggpairs(
        data = beta_df,
        lower = list(continuous = wrap(lower_fn)),
        diag = list(continuous = wrap(diag_fn)),
        upper = list(continuous = wrap(upper_fn)),
        progress = FALSE
    ) +
        theme(
            panel.grid = element_blank(),
            strip.background = element_rect(fill = "#2F4F4F"),
            strip.text = element_text(color = "white", face = "bold")
        )
    
    return(gg)
}

plot_sigma_posterior <- function(sigma_samples, 
                                 fill_color = "#4B0082", 
                                 line_color = "#2F4F4F",
                                 cred_level = 0.95,
                                 bins = 30,
                                 alpha = 0.7) {
    
    # Calcular intervalos de credibilidad
    cred_interval <- quantile(sigma_samples, 
                              probs = c((1 - cred_level)/2, 1 - (1 - cred_level)/2))
    
    # Crear el gráfico
    gg <- ggplot(data.frame(sigma2 = sigma_samples), aes(x = sigma2)) +
        geom_histogram(aes(y = after_stat(density)),
                       fill = fill_color,
                       color = line_color,
                       alpha = alpha,
                       bins = bins) +
        geom_density(color = line_color, 
                     linewidth = 1.2, 
                     adjust = 1.5) +
        geom_vline(xintercept = cred_interval,
                   color = "firebrick",
                   linetype = "dashed",
                   linewidth = 0.8) +
        annotate("text",
                 x = mean(cred_interval),
                 y = Inf,
                 label = paste0(cred_level*100, "% CI: [", 
                                round(cred_interval[1], 2), ", ",
                                round(cred_interval[2], 2), "]"),
                 vjust = 1.5,
                 hjust = 0.5,
                 color = "firebrick",
                 size = 4) +
        labs(title = "Distribución Posterior de σ²",
             x = expression(paste("Valor de ", sigma^2)),
             y = "Densidad") +
        theme_minimal(base_size = 14) +
        theme(
            plot.title = element_text(face = "bold", hjust = 0.5),
            axis.title = element_text(color = "#2F4F4F"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_line(linewidth = 0.1),
            plot.background = element_rect(fill = "white", color = NA)
        )
    
    return(gg)
}


####################################################################3

plot_marginal_theoretical <- function(posterior_samples, 
                                      X, y, 
                                      beta_bar, 
                                      A, 
                                      nu0, 
                                      s0_sq) {
    
    if (ncol(posterior_samples$beta) != 2) {
        stop("La función solo funciona para modelos con intercepto y un predictor.")
    }
    
    X <- cbind(1, X)
    n <- nrow(X)
    k <- ncol(X)
    XtX <- crossprod(X)
    XtX_A <- XtX + A
    XtX_A_inv <- solve(XtX_A)
    # Media condicional corregida
    beta_post_mean <- XtX_A_inv %*% (crossprod(X, y) + A %*% beta_bar)
    
    # Cálculo correcto del parámetro S
    S <- nu0 * s0_sq + 
        crossprod(y) + 
        t(beta_bar) %*% A %*% beta_bar - 
        t(beta_post_mean) %*% XtX_A %*% beta_post_mean
    
    # Grados de libertad
    nu <- n + nu0  
    
    # Rangos para graficar distribuciones
    x_range_beta0 <- seq(
        min(posterior_samples$beta[, 1]) - 2*sd(posterior_samples$beta[, 1]),
        max(posterior_samples$beta[, 1]) + 2*sd(posterior_samples$beta[, 1]),
        length.out = 200
    )
    
    x_range_beta1 <- seq(
        min(posterior_samples$beta[, 2]) - 2*sd(posterior_samples$beta[, 2]),
        max(posterior_samples$beta[, 2]) + 2*sd(posterior_samples$beta[, 2]),
        length.out = 200
    )
    
    x_range_sigma <- seq(
        0.1,
        max(posterior_samples$sigma2) + 2*sd(posterior_samples$sigma2),
        length.out = 200
    )
    
    # Densidades teóricas corregidas
    theoretical_densities <- list(
        beta0 = data.frame(
            x = x_range_beta0,
            y = dt(
                (x_range_beta0 - beta_post_mean[1]) / sqrt((S / nu) * XtX_A_inv[1,1]),  
                df = nu
            ) / sqrt((S / nu) * XtX_A_inv[1,1])
        ), 
        
        beta1 = data.frame(
            x = x_range_beta1,
            y = dt(
                (x_range_beta1 - beta_post_mean[2]) / sqrt((S / nu) * XtX_A_inv[2,2]), 
                df = nu
            ) / sqrt((S / nu) * XtX_A_inv[2,2])
        )
    )
    
    # Obtener la altura máxima del histograma de sigma2
    hist_data <- hist(posterior_samples$sigma2, plot = FALSE, breaks = 50) 
    max_hist_density <- max(hist_data$density)  # Máxima densidad observada en el histograma
    
    # Calcular la densidad teórica sin escalar
    raw_density <- dinvgamma(x_range_sigma, shape = nu/2, rate = S/2)
    
    # Escalar la densidad teórica para que tenga una altura comparable con el histograma
    scaling_factor <- max_hist_density / max(raw_density)
    
    # Aplicar el escalamiento
    theoretical_densities$sigma2 <- data.frame(
        x = x_range_sigma,
        y = raw_density * scaling_factor
    )
    
    # Gráficos
    plot_beta0 <- ggplot(data.frame(beta0 = posterior_samples$beta[,1]), aes(x = beta0)) +
        geom_histogram(aes(y = ..density..), bins = 50, fill = "#4B0082", alpha = 0.6) +
        geom_line(data = theoretical_densities$beta0, aes(x = x, y = y), 
                  color = "#FF6B6B", linewidth = 1.2) +
        labs(title = "Marginal de β₀", x = "β₀", y = "Densidad")
    
    plot_beta1 <- ggplot(data.frame(beta1 = posterior_samples$beta[,2]), aes(x = beta1)) +
        geom_histogram(aes(y = ..density..), bins = 50, fill = "#4B0082", alpha = 0.6) +
        geom_line(data = theoretical_densities$beta1, aes(x = x, y = y), 
                  color = "#FF6B6B", linewidth = 1.2) +
        labs(title = "Marginal de β₁", x = "β₁", y = "Densidad")
    
    plot_sigma2 <- ggplot(data.frame(sigma2 = posterior_samples$sigma2), aes(x = sigma2)) +
        geom_histogram(aes(y = ..density..), bins = 50, fill = "#2F4F4F", alpha = 0.6) +
        geom_line(data = theoretical_densities$sigma2, aes(x = x, y = y), 
                  color = "#2E8B57", linewidth = 1.2) +
        labs(title = "Marginal de σ²", x = "σ²", y = "Densidad")
    
    # Combinar gráficos
    grid.arrange(
        plot_beta0, 
        plot_beta1, 
        plot_sigma2,
        ncol = 2,
        layout_matrix = rbind(c(1, 2), c(3, 3))
    )
}

generate_data <- function(n = 50, beta0 = 0.8, beta1 = 1.3, sigma = 0.6) {
    x <- rnorm(n)
    y <- beta0 + beta1 * x + rnorm(n, sd = sigma)
    return(data.frame(x = x, y = y))
}

data <- generate_data()
</script>
 
<script type="application/shiny-prerendered" data-context="server">
output$plotdata <- renderPlot({
    
    p <- ggplot(data = data, 
                aes(x = x, y = y)) + 
        geom_point(color = "#55A154", alpha = 0.35, size = 3) +
        labs(
            title = "",
            y = expression(log(frac(plain(B)[1], plain(B)[2]))),
            x = expression(log(frac(plain(R)[1], plain(R)[2]))
            ))
    p
    })


posterior_data <- eventReactive(input$run_sampling, {
    
    if (nrow(data) == 0) return(NULL)  # Evita error si los datos no están cargados
    
    X <- data$x
    y <- data$y
    
    betas_mean <- matrix(c(input$prior_mean_b0, input$prior_mean_b1), nrow = 2, ncol = 1)
    
    cov_betas <- input$prior_corr * input$sd_mean_b0 * input$sd_mean_b1
    
    sigma <- matrix(c(input$sd_mean_b0^2, cov_betas, 
                      cov_betas, input$sd_mean_b1^2), 
                    nrow = 2, ncol = 2)
    
    samples <- sampling_posterior(
        y, X, betas_mean, 
        sigma, input$df_chi, input$scale_chi, 
        n_samples = input$n_samples
    )
    
    list(samples = samples, betas_mean = betas_mean, sigma = sigma)
})

output$plotpostfitdata <- renderPlot({
    posterior <- posterior_data()
    if (is.null(posterior)) return(NULL)  # Evita error si posterior_data aún no existe
    
    X <- data$x
    y <- data$y
    
    plot_bayes_regression(
        y, X, posterior$samples,  # Extraer muestras
        posterior$betas_mean,      # Extraer media
        posterior$sigma,           # Extraer sigma
        input$df_chi, input$scale_chi,
        input$alpha
    )
})

output$plot_betas_postconj <- renderPlot({
    
    posterior <- posterior_data()
    if (is.null(posterior)) return(NULL)  # Evita error si posterior_data aún no existe
    
    plot_joint_posterior(posterior$samples, alpha = 0.7, bins = 30)
})

output$plot_sigma_post <- renderPlot({
    
    posterior <- posterior_data()
    if (is.null(posterior)) return(NULL)  # Evita error si posterior_data aún no existe
    
    plot_sigma_posterior(posterior$samples$sigma2, alpha = 0.7, bins = 30, cred_level = input$alpha)
})

output$plot_marginales <- renderPlot({
    
    posterior <- posterior_data()
    if (is.null(posterior)) return(NULL)  # Evita error si posterior_data aún no existe
    
    X <- data$x
    y <- data$y
    
    plot_marginal_theoretical(posterior$samples, X, y, 
                              posterior$betas_mean,      # Extraer media
                              posterior$sigma,           # Extraer sigma
                              input$df_chi, input$scale_chi) 
})
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.10.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmltools-fill"]},{"type":"character","attributes":{},"value":["0.5.8.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["fill"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["fill.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmltools"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.5.8.1"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64]}},"value":[{"type":"character","attributes":{},"value":["base","bslib","cachem","cli","colorspace","compiler","data.table","datasets","digest","dplyr","evaluate","fastmap","generics","GGally","ggplot2","ggstats","glue","graphics","grDevices","grid","gridExtra","gtable","HDInterval","htmltools","htmlwidgets","httpuv","invgamma","jquerylib","jsonlite","knitr","later","lifecycle","magrittr","MASS","memoise","methods","mime","munsell","pillar","pkgconfig","plyr","promises","purrr","R6","RColorBrewer","Rcpp","rlang","rmarkdown","sass","scales","shiny","stats","tibble","tidyr","tidyselect","tools","utils","vctrs","viridis","viridisLite","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["4.4.2","0.9.0","1.1.0","3.6.3","2.1-1","4.4.2","1.16.4","4.4.2","0.6.37","1.1.4","1.0.3","1.2.0","0.1.3","2.2.1","3.5.1","0.8.0","1.8.0","4.4.2","4.4.2","4.4.2","2.3","0.3.6","0.2.4","0.5.8.1","1.6.4","1.6.15","1.1","0.1.4","1.9.0","1.49","1.4.1","1.0.4","2.0.3","7.3-61","2.0.1","4.4.2","0.12","0.5.1","1.10.1","2.0.3","1.8.9","1.3.2","1.0.4","2.5.1","1.1-3","1.0.14","1.1.5","2.29","0.4.9","1.3.0","1.10.0","4.4.2","3.2.1","1.3.1","1.2.1","4.4.2","4.4.2","0.6.5","0.6.5","0.4.2","3.0.2","0.50","1.8-4","2.3.10"]}]}]}
</script>
<!--/html_preserve-->


<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /container fluid -->

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>